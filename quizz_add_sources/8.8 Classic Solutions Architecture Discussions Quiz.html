<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz</title>
    <style>
      * {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
          Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-size: 16px;
      }

      main {
        padding-top: 48px;
      }

      :root {
        --large-device-width: 850px;
        --primary-color: #0f172a;
        --secondary-color: #020617;
        --primary-text-color: #c7d1dd;
        --secondary-text-color: #061602;
        --success-background: hsl(159, 82%, 24%);
        --success-foreground: hsl(164, 86%, 16%);
        --success: hsl(160, 84%, 39%);
        --danger: #ef4444;
        --warning: #f59e0b;
        --info-background: hsl(218, 81%, 8%);
        --info-foreground: hsl(217, 91%, 85%);
        --border-color: #d1d7dc;
        --check-box-size: 20px;
        /* control the size */
        --check-box-color: var(--info-foreground);
        /* the active color */
      }

      body {
        position: relative;
        background-color: #020617;
        color: var(--primary-text-color);
      }

      #score-stats-container {
        position: fixed;
        z-index: 10;
        top: 0;
        height: 40px;
        width: 100%;
        background-color: var(--info-background);

        padding: 0px 16px;
        color: var(--info-foreground);
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      #quiz-container {
        border-radius: 8px;
        display: flex;
        gap: 16px;
        flex-direction: column;
      }

      input[type='radio'] {
        height: var(--check-box-size);
        aspect-ratio: 1;
        border: calc(var(--check-box-size) / 8) solid #939393;
        padding: calc(var(--check-box-size) / 8);
        background: radial-gradient(farthest-side, var(--check-box-color) 94%, #0000) 50%/0 0 no-repeat
          content-box;
        border-radius: 50%;
        outline-offset: calc(var(--check-box-size) / 10);
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        cursor: pointer;
        font-size: inherit;
        transition: 0.3s;
      }

      input[type='radio']:checked {
        border-color: var(--check-box-color);
        background-size: 100% 100%;
      }

      input[type='radio']:disabled {
        background: linear-gradient(#939393 0 0) 50%/100% 20% no-repeat content-box;
        opacity: 0.5;
        cursor: not-allowed;
      }

      label {
        /* display: inline-flex; */
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 4px 6px;
        border-radius: 4px;
      }

      @media (max-width: 767px) {
        input[type='radio'],
        label {
          cursor: default;
        }

        #quiz-container {
          margin-left: 8px;
          margin-right: 8px;
        }
      }

      /* PC (Desktop devices) */
      @media (min-width: 768px) {
        body {
          display: flex;
          justify-content: center;
        }

        main {
          max-width: var(--large-device-width);
        }

        #score-stats-container {
          max-width: var(--large-device-width);
        }

        dialog {
          max-width: var(--large-device-width);
        }
      }

      @media print {
        input[type='radio'] {
          background: none !important;
          border-color: #939393 !important;
        }

        input[type='radio']:checked {
          border-color: #939393 !important;
        }
      }

      .question-lable {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      button {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        outline: none;
        position: relative;
        overflow: hidden;
        cursor: pointer;
      }

      .button {
        background-color: var(--success-background);
        border: none;
        color: #f4f5f7;
        opacity: 0.8;
        font-size: 18px;
        flex-grow: 1;
        padding: 8px 16px;
        border-radius: 8px;
      }

      .button:hover {
        opacity: 1;
      }

      .explanation-btn {
        border: none;
        color: var(--success);
        background-color: transparent;
      }

      #submit-button:active::after {
        background-color: #ef4444;
      }

      .single-question-container {
        background-color: var(--primary-color);
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 16px;
        border-radius: 8px;
      }

      #modal-content {
        padding: 16px;
        line-height: 24px;
      }

      dialog::backdrop {
        background: rgba(0, 0, 0, 0.5);
      }

      dialog {
        position: fixed;
        border: 1px solid var(--border-color);
        background-color: var(--primary-color);
        color: rgb(240, 241, 248);
        padding: 16px;
        border-radius: 8px;
        width: 80vw;
        max-height: 80vh;
        overflow: auto;
        top: 50%;
        left: 50%;
        -webkit-transform: translateX(-50%) translateY(-50%);
        -moz-transform: translateX(-50%) translateY(-50%);
        -ms-transform: translateX(-50%) translateY(-50%);
        transform: translateX(-50%) translateY(-50%);
      }

      #close-modal-btn {
        position: absolute;
        top: 4px;
        right: 4px;
        padding: 2px 8px;
        border-radius: 2px;
        border: none;
        background-color: var(--danger);
      }

      .correct-answer label {
        border: 2px solid var(--success);
        width: 100%;
      }

      .incorrect-answer label {
        border: 2px solid var(--danger);
        width: 100%;
      }

      .options-container {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      #quiz-meta-container {
        border-radius: 8px;
        background-color: var(--primary-color);
        margin-bottom: 12px;
        padding: 8px;
      }

      #quiz-title {
        text-align: center;
        font-size: 24px;
        margin-bottom: 8px;
      }

      #quiz-description {
        line-height: 1.5;
        padding: 2px 6px;
      }
      img {
        width: 100%;
      }
    </style>
  </head>

  <body onload="main()">
    <main>
      <section id="quiz-meta-container">
        <h1 id="quiz-title"></h1>
        <p id="quiz-description"></p>
      </section>
      <section id="score-stats-container">
        <div id="score-card">
          Score: <span id="current-score">999</span> of
          <span id="pass-percent">999%</span>
        </div>
        <div>Correct: <span id="correct-answers">999</span></div>
        <div>Incorrect: <span id="wrong-answers">999</span></div>
      </section>

      <section id="quiz-container"></section>

      <dialog id="modal" class="modal-container">
        <div id="modal-content">
          <p id="modal-text"></p>
        </div>
      </dialog>
    </main>

    <script>
      const quizData = {"quiz_id":5336943,"quiz_title":"Classic Solutions Architecture Discussions Quiz","questions":[{"_class":"assessment","id":37586457,"assessment_type":"multiple-choice","prompt":{"relatedLectureIds":"","feedbacks":["This is not efficient for scaling purposes.","This is the way to save further costs as we will run 2 EC2 instances no matter what.","Our solution won't be highly available anymore.","Our solution will experience downtime."],"question":"<p>Your website <strong>TriangleSunglasses.com</strong> is hosted on a fleet of EC2 instances managed by an Auto Scaling Group and fronted by an Application Load Balancer. Your ASG has been configured to scale on-demand based on the traffic going to your website. To reduce costs, you have configured the ASG to scale based on the traffic going through the ALB. To make the solution highly available, you have updated your ASG and set the minimum capacity to 2. How can you further reduce the costs while respecting the requirements?</p>","answers":["<p>Remove the ALB and use an Elastic IP instead</p>","<p>Reserve two EC2 instances</p>","<p>Reduce the minimum capacity to 1</p>","<p>Reduce the minimum capacity to 0</p>"]},"correct_response":["b"],"section":"","question_plain":"Your website TriangleSunglasses.com is hosted on a fleet of EC2 instances managed by an Auto Scaling Group and fronted by an Application Load Balancer. Your ASG has been configured to scale on-demand based on the traffic going to your website. To reduce costs, you have configured the ASG to scale based on the traffic going through the ALB. To make the solution highly available, you have updated your ASG and set the minimum capacity to 2. How can you further reduce the costs while respecting the requirements?","related_lectures":[]},{"_class":"assessment","id":37586467,"assessment_type":"multiple-choice","prompt":{"feedbacks":["This will help as the data can be accessed from multiple EC2 instances.","This will help as the data can be accessed from multiple EC2 instances.","This will help as the clients send their session data so that our EC2 instances don't need to remember/store session data.","EBS volumes are created in a specific AZ and can only be attached to one EC2 instance at a time."],"answers":["<p>Store session data in Amazon RDS</p>","<p>Store session data in Amazon ElastiCache</p>","<p>Store session data in the client HTTP cookies</p>","<p>Store session data on EBS volumes</p>"],"relatedLectureIds":"","question":"<p>Which of the following will <strong>NOT</strong> help us while designing a <strong>STATELESS</strong> application tier?</p>"},"correct_response":["d"],"section":"","question_plain":"Which of the following will NOT help us while designing a STATELESS application tier?","related_lectures":[]},{"_class":"assessment","id":37586481,"assessment_type":"multiple-choice","prompt":{"answers":["<p>Store the software updates on EBS and sync them using data replication software from one master in each AZ</p>","<p>Store the software updates on EFS and mount EFS as a network drive at startup</p>","<p>Package the software updates as an EBS snapshot and create EBS volumes for each new software update</p>","<p>Store the software updates on Amazon RDS</p>"],"question":"<p>You want to install software updates on 100s of Linux EC2 instances that you manage. You want to store these updates on shared storage which should be dynamically loaded on the EC2 instances and shouldn't require heavy operations. What do you suggest?</p>","relatedLectureIds":"","feedbacks":["This requires too many operations and is not a native AWS feature.","EFS is a network file system (NFS) that allows you to mount the same file system to 100s of EC2 instances. Storing software updates on an EFS allows each EC2 instance to access them.","This requires too many operations although it would work.","RDS is meant to store relational data, not big binary files."]},"correct_response":["b"],"section":"","question_plain":"You want to install software updates on 100s of Linux EC2 instances that you manage. You want to store these updates on shared storage which should be dynamically loaded on the EC2 instances and shouldn't require heavy operations. What do you suggest?","related_lectures":[]},{"_class":"assessment","id":37586493,"assessment_type":"multiple-choice","prompt":{"question":"<p>As a Solutions Architect, you're planning to migrate a complex ERP software suite to AWS Cloud. You're planning to host the software on a set of Linux EC2 instances managed by an Auto Scaling Group. The software traditionally takes over an hour to set up on a Linux machine. How do you recommend you speed up the installation process when there's a scale-out event?</p>","feedbacks":["Golden AMI is an image that contains all your software installed and configured so that future EC2 instances can boot up quickly from that AMI.","EC2 User Data allows you to automate the installation steps, but the installation would still take one hour to complete.","RDS is used to store relational data, not applications.","Retrieving application setup files from EFS won't help speed up the installation and configuration time."],"answers":["<p>Use a Golden AMI</p>","<p>Bootstrap using EC2 User Data</p>","<p>Store the application in Amazon RDS</p>","<p>Retrieve the application setup files from EFS</p>"],"relatedLectureIds":""},"correct_response":["a"],"section":"","question_plain":"As a Solutions Architect, you're planning to migrate a complex ERP software suite to AWS Cloud. You're planning to host the software on a set of Linux EC2 instances managed by an Auto Scaling Group. The software traditionally takes over an hour to set up on a Linux machine. How do you recommend you speed up the installation process when there's a scale-out event?","related_lectures":[]},{"_class":"assessment","id":37586499,"assessment_type":"multiple-choice","prompt":{"relatedLectureIds":"","question":"<p>You're developing an application and would like to deploy it to Elastic Beanstalk with minimal cost. You should run it in ..................</p>","feedbacks":["The question mentions that you're still in the development stage and you want to reduce costs. Single Instance Mode will create one EC2 instance and one Elastic IP.","This will create one or more EC2 instances and one Elastic Load Balancer (this costs more)."],"answers":["<p>Single Instance Mode</p>","<p>High Availability Mode</p>"]},"correct_response":["a"],"section":"","question_plain":"You're developing an application and would like to deploy it to Elastic Beanstalk with minimal cost. You should run it in ..................","related_lectures":[]},{"_class":"assessment","id":37586643,"assessment_type":"multiple-choice","prompt":{"relatedLectureIds":"","question":"<p>You're deploying your application to an Elastic Beanstalk environment but you notice that the deployment process is painfully slow. After reviewing the logs, you found that your dependencies are resolved on each EC2 instance each time you deploy. How can you speed up the deployment process with minimal impact?</p>","answers":["<p>Remove some dependencies in your code</p>","<p>Place the dependencies in Amazon EFS</p>","<p>Create a Golden AMI that contains the dependencies and use that image to launch the EC2 instances</p>"],"feedbacks":["","","Golden AMI is an image that contains all your software, dependencies, and configurations, so that future EC2 instances can boot up quickly from that AMI."]},"correct_response":["c"],"section":"","question_plain":"You're deploying your application to an Elastic Beanstalk environment but you notice that the deployment process is painfully slow. After reviewing the logs, you found that your dependencies are resolved on each EC2 instance each time you deploy. How can you speed up the deployment process with minimal impact?","related_lectures":[]}]};
      let correct = new Set();
      let incorrect = new Set();
      let totalNumberOfQuestions = 0;
      const quizTitle = quizData.quiz_title;
      const quizDescription = quizData.quiz_description;
      const questionData = quizData.questions;
      const passPercent = quizData.pass_percent;
      const modalTextElement = document.getElementById('modal-text');
      const quizContainerElement = document.getElementById('quiz-container');

      const dialog = document.querySelector('dialog');
      const showButton = document.getElementById('view-explanatin');
      const closeButton = document.getElementById('close-modal-btn');
      const quizTitleElement = document.getElementById('quiz-title');
      const quizDescriptionElement = document.getElementById('quiz-description');

      function main() {
        // update quiz meta data
        document.title = quizTitle;
        quizTitleElement.innerHTML = quizTitle;
        quizDescriptionElement.innerHTML = quizDescription;

        const passPercentElement = document.getElementById('pass-percent');
        passPercentElement.innerHTML = passPercent + '%';
        totalNumberOfQuestions = questionData.length;
        // shuffle the questionData to randomize the order of the questions
        for (let i = questionData.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [questionData[i], questionData[j]] = [questionData[j], questionData[i]];
        }

        let formattedQuestions = questionData.map(formatSingleQuestionData);
        updateScore();
        // display the formattedQuestions
        formattedQuestions.forEach((question, idx) => {
          renderSingleQuestion(question, idx + 1);
        });
      }

      /**
       * Formats the question data from the given QuizData object.
       *
       * @param {Object} singleQuizData - The singleQuizData object containing prompt and correct_response.
       * @return {Object} The formatted question object with the following properties:
       *   - id: The ID of the question.
       *   - question: The text of the question.
       *   - answers: The array of answer options.
       *   - correctAnswer: The text of the correct answer.
       *   - explanation: The explanation of the correct answer.
       */
      function formatSingleQuestionData(singleQuizData = null) {
        const { prompt, correct_response, id } = singleQuizData;
        const questionText = prompt.question;
        const answers = prompt.answers;
        const correctAnswer = correct_response[0];
        const correctAnswerText = answers[correctAnswer.toLowerCase().charCodeAt(0) - 97];
        const questionObj = {
          id: id,
          question: questionText,
          answers: answers,
          correctAnswer,
          explanation: prompt?.explanation || '',
        };
        return questionObj;
      }

      /**
       * Renders a single question with its options and submit button.
       *
       * @param {Object} singleQuestionData - The data of the question to render.
       * @param {number} rootIndex - The index of the question in the quiz.
       * @return {void} return nothing.
       */

      const renderSingleQuestion = (singleQuestionData = {}, rootIndex = 1) => {
        const { id, explanation, answers, correctAnswer, question } = singleQuestionData;
        // shuffle the answers to randomize the order of the answers
        // for (let i = answers.length - 1; i > 0; i--) {
        //   const j = Math.floor(Math.random() * (i + 1));
        //   [answers[i], answers[j]] = [answers[j], answers[i]];
        // }
        const alphabet = 'abcdefghijklmnopqrstuvwxyz'.split('');
        const optionsHTML = answers
          .map((option, index) => {
            const optionId = `${id}_${index}`;

            return `
        <div class="question-lable">
          <input type="radio" id="${optionId}" name="${'answer'}" value="${alphabet[index]}" />
          <label for="${optionId}">${option}</label>
        </div>
      `;
          })

          .join('');

        const container = document.createElement('div');
        container.innerHTML = `
        <form data-correct-answer="${correctAnswer}" data-question-id="${id}" class="single-question-container" onsubmit="submitButtonListener(event)">
          <div style="display: flex;justify-content: space-between;">
            <p style="font-weight: 600">Question ${rootIndex}:</p>
            <button type="button" onclick="renderExplanation(event)" id="${`explanation-${id}`}" data-explanation="${'tt'}" data-explanation-id=${id} class="explanation-btn">View Explanation</button>
          </div>
          <p style="margin-bottom: 8px;line-height: 1.5">${question}</p>
          <div class="options-container">
            ${optionsHTML}
          </div>
          <div style="display: flex; gap: 8px;">
            <button type="submit" id="submit-button" class="button">Submit</button>
          </div>
        </form>
      `;
        quizContainerElement.appendChild(container);
      };

      /**
       * Updates the score on the page based on the number of correct and incorrect answers.
       *
       * @return {void} This function does not return a value.
       */
      function updateScore() {
        const currentParcentageElement = document.getElementById('current-score');
        const correctAnswerElement = document.getElementById('correct-answers');
        const wrongAnswerElement = document.getElementById('wrong-answers');
        correctAnswerElement.innerHTML = correct.size;
        wrongAnswerElement.innerHTML = incorrect.size;
        const score = Number((correct.size / totalNumberOfQuestions) * 100).toFixed(2);
        currentParcentageElement.innerHTML = score;
      }

      /**
       * Handles the event when the submit button is clicked.
       *
       * @param {Event} e - The event object.
       * @return {void} This function does not return anything.
       */
      const submitButtonListener = e => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const form = e.target;
        const selectedOption = e.target.querySelector('input[type="radio"]:checked');
        if (!selectedOption) {
          alert('Please select an answer!');
          return;
        }

        let isCorrect = false;
        const { answer: userAnswer } = Object.fromEntries(formData.entries());
        const correctAnswer = e.target.dataset.correctAnswer;
        const questionId = e.target.dataset.questionId;
        if (userAnswer == correctAnswer) {
          correct.add(questionId);
          incorrect.delete(questionId);
          isCorrect = true;
        } else {
          incorrect.add(e.target.dataset.questionId);
          correct.delete(questionId);
        }
        updateScore();

        const resultClass = isCorrect ? 'correct-answer' : 'incorrect-answer';

        form.querySelectorAll('.question-lable').forEach(label => {
          label.classList.remove('correct-answer', 'incorrect-answer');
        });
        selectedOption.closest('.question-lable').classList.add(resultClass);
      };

      function renderExplanation(ev) {
        const dataid = ev.target.dataset.explanationId;
        const quiz = quizData.questions.find(q => q.id === Number(dataid));
        modalTextElement.innerHTML =
          quiz && quiz.prompt.explanation ? quiz.prompt.explanation : 'no explanation found';
        // modalTextElement.innerHTML = ev.target.dataset?.explanation || 'no explanation found';
        dialog.showModal();
        dialog.addEventListener('click', event => {
          if (event.target === dialog) {
            dialog.close();
          }
        });
      }
    </script>
  </body>
</html>
